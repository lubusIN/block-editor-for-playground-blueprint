(()=>{"use strict";const e=window.ReactJSXRuntime,{ButtonBlockAppender:n}=wp.blockEditor,{useSelect:l}=wp.data;wp.hooks.addFilter("editor.BlockEdit","block-editor-for-playground-blueprint/default-block-appender",(t=>i=>{const a=l((e=>{const n=e("core/block-editor").getBlockOrder();return n[n.length-1]}),[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t,{...i}),i.clientId===a&&(0,e.jsx)("div",{className:"block-list-appender wp-block",children:(0,e.jsx)(n,{rootClientId:null})})]})}));const t=window.wp.i18n,i=window.wp.plugins,a=window.wp.editor,o=window.wp.primitives,s=(0,e.jsx)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,e.jsx)(o.Path,{d:"M12 3.3c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8s-4-8.8-8.8-8.8zm6.5 5.5h-2.6C15.4 7.3 14.8 6 14 5c2 .6 3.6 2 4.5 3.8zm.7 3.2c0 .6-.1 1.2-.2 1.8h-2.9c.1-.6.1-1.2.1-1.8s-.1-1.2-.1-1.8H19c.2.6.2 1.2.2 1.8zM12 18.7c-1-.7-1.8-1.9-2.3-3.5h4.6c-.5 1.6-1.3 2.9-2.3 3.5zm-2.6-4.9c-.1-.6-.1-1.1-.1-1.8 0-.6.1-1.2.1-1.8h5.2c.1.6.1 1.1.1 1.8s-.1 1.2-.1 1.8H9.4zM4.8 12c0-.6.1-1.2.2-1.8h2.9c-.1.6-.1 1.2-.1 1.8 0 .6.1 1.2.1 1.8H5c-.2-.6-.2-1.2-.2-1.8zM12 5.3c1 .7 1.8 1.9 2.3 3.5H9.7c.5-1.6 1.3-2.9 2.3-3.5zM10 5c-.8 1-1.4 2.3-1.8 3.8H5.5C6.4 7 8 5.6 10 5zM5.5 15.3h2.6c.4 1.5 1 2.8 1.8 3.7-1.8-.6-3.5-2-4.4-3.7zM14 19c.8-1 1.4-2.2 1.8-3.7h2.6C17.6 17 16 18.4 14 19z"})}),r=(0,e.jsx)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,e.jsx)(o.Path,{d:"M18 11.3l-1-1.1-4 4V3h-1.5v11.3L7 10.2l-1 1.1 6.2 5.8 5.8-5.8zm.5 3.7v3.5h-13V15H4v5h16v-5h-1.5z"})}),d=(0,e.jsx)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,e.jsx)(o.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5 4.5h11a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 1 .5-.5ZM3 5a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5Zm17 3v10.75c0 .69-.56 1.25-1.25 1.25H6v1.5h12.75a2.75 2.75 0 0 0 2.75-2.75V8H20Z"})}),c=(0,e.jsx)(o.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,e.jsx)(o.Path,{d:"M20.8 10.7l-4.3-4.3-1.1 1.1 4.3 4.3c.1.1.1.3 0 .4l-4.3 4.3 1.1 1.1 4.3-4.3c.7-.8.7-1.9 0-2.6zM4.2 11.8l4.3-4.3-1-1-4.3 4.3c-.7.7-.7 1.8 0 2.5l4.3 4.3 1.1-1.1-4.3-4.3c-.2-.1-.2-.3-.1-.4z"})}),u=window.wp.data,p=window.wp.notices,m=window.wp.compose,f=window.wp.blob,h=window.wp.element,g=(0,h.createContext)({fields:[]});function b({fields:n,children:l}){return(0,e.jsx)(g.Provider,{value:{fields:n},children:l})}const x=g,v={sort:function(e,n,l){return"asc"===l?e-n:n-e},isValid:function(e,n){if(""===e)return!1;if(!Number.isInteger(Number(e)))return!1;if(n?.elements){const l=n?.elements.map((e=>e.value));if(!l.includes(Number(e)))return!1}return!0},Edit:"integer"},_={sort:function(e,n,l){return"asc"===l?e.localeCompare(n):n.localeCompare(e)},isValid:function(e,n){if(n?.elements){const l=n?.elements?.map((e=>e.value));if(!l.includes(e))return!1}return!0},Edit:"text"},w={sort:function(e,n,l){const t=new Date(e).getTime(),i=new Date(n).getTime();return"asc"===l?t-i:i-t},isValid:function(e,n){if(n?.elements){const l=n?.elements.map((e=>e.value));if(!l.includes(e))return!1}return!0},Edit:"datetime"},j=window.wp.components,y={datetime:function({data:n,field:l,onChange:t,hideLabelFromVision:i}){const{id:a,label:o}=l,s=l.getValue({item:n}),r=(0,h.useCallback)((e=>t({[a]:e})),[a,t]);return(0,e.jsxs)("fieldset",{className:"dataviews-controls__datetime",children:[!i&&(0,e.jsx)(j.BaseControl.VisualLabel,{as:"legend",children:o}),i&&(0,e.jsx)(j.VisuallyHidden,{as:"legend",children:o}),(0,e.jsx)(j.TimePicker,{currentTime:s,onChange:r,hideLabelFromVision:!0})]})},integer:function({data:n,field:l,onChange:t,hideLabelFromVision:i}){var a;const{id:o,label:s,description:r}=l,d=null!==(a=l.getValue({item:n}))&&void 0!==a?a:"",c=(0,h.useCallback)((e=>t({[o]:Number(e)})),[o,t]);return(0,e.jsx)(j.__experimentalNumberControl,{label:s,help:r,value:d,onChange:c,__next40pxDefaultSize:!0,hideLabelFromVision:i})},radio:function({data:n,field:l,onChange:t,hideLabelFromVision:i}){const{id:a,label:o}=l,s=l.getValue({item:n}),r=(0,h.useCallback)((e=>t({[a]:e})),[a,t]);return l.elements?(0,e.jsx)(j.RadioControl,{label:o,onChange:r,options:l.elements,selected:s,hideLabelFromVision:i}):null},select:function({data:n,field:l,onChange:i,hideLabelFromVision:a}){var o,s;const{id:r,label:d}=l,c=null!==(o=l.getValue({item:n}))&&void 0!==o?o:"",u=(0,h.useCallback)((e=>i({[r]:e})),[r,i]),p=[{label:(0,t.__)("Select item"),value:""},...null!==(s=l?.elements)&&void 0!==s?s:[]];return(0,e.jsx)(j.SelectControl,{label:d,value:c,options:p,onChange:u,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,hideLabelFromVision:a})},text:function({data:n,field:l,onChange:t,hideLabelFromVision:i}){const{id:a,label:o,placeholder:s}=l,r=l.getValue({item:n}),d=(0,h.useCallback)((e=>t({[a]:e})),[a,t]);return(0,e.jsx)(j.TextControl,{label:o,placeholder:s,value:null!=r?r:"",onChange:d,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,hideLabelFromVision:i})}};function C(e){if(Object.keys(y).includes(e))return y[e];throw"Control "+e+" not found"}const V=e=>({item:n})=>{const l=e.split(".");let t=n;for(const e of l)t=t.hasOwnProperty(e)?t[e]:void 0;return t};function k(e){return void 0!==e.children}function P({title:n}){return(0,e.jsx)(j.__experimentalVStack,{className:"dataforms-layouts-regular__header",spacing:4,children:(0,e.jsxs)(j.__experimentalHStack,{alignment:"center",children:[(0,e.jsx)(j.__experimentalHeading,{level:2,size:13,children:n}),(0,e.jsx)(j.__experimentalSpacer,{})]})})}const S=(0,e.jsx)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,e.jsx)(o.Path,{d:"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"})});function N({title:n,onClose:l}){return(0,e.jsx)(j.__experimentalVStack,{className:"dataforms-layouts-panel__dropdown-header",spacing:4,children:(0,e.jsxs)(j.__experimentalHStack,{alignment:"center",children:[n&&(0,e.jsx)(j.__experimentalHeading,{level:2,size:13,children:n}),(0,e.jsx)(j.__experimentalSpacer,{}),l&&(0,e.jsx)(j.Button,{label:(0,t.__)("Close"),icon:S,onClick:l,size:"small"})]})})}function B({fieldDefinition:n,popoverAnchor:l,labelPosition:i="side",data:a,onChange:o,field:s}){const r=k(s)?s.label:n?.label,d=(0,h.useMemo)((()=>k(s)?{type:"regular",fields:s.children.map((e=>"string"==typeof e?{id:e}:e))}:{type:"regular",fields:[{id:s.id}]}),[s]),c=(0,h.useMemo)((()=>({anchor:l,placement:"left-start",offset:36,shift:!0})),[l]);return(0,e.jsx)(j.Dropdown,{contentClassName:"dataforms-layouts-panel__field-dropdown",popoverProps:c,focusOnMount:!0,toggleProps:{size:"compact",variant:"tertiary",tooltipPosition:"middle left"},renderToggle:({isOpen:l,onToggle:o})=>(0,e.jsx)(j.Button,{className:"dataforms-layouts-panel__field-control",size:"compact",variant:["none","top"].includes(i)?"link":"tertiary","aria-expanded":l,"aria-label":(0,t.sprintf)(
// translators: %s: Field name.
// translators: %s: Field name.
(0,t._x)("Edit %s","field"),r),onClick:o,children:(0,e.jsx)(n.render,{item:a})}),renderContent:({onClose:n})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(N,{title:r,onClose:n}),(0,e.jsx)(H,{data:a,form:d,onChange:o,children:(n,l)=>{var t;return(0,e.jsx)(n,{data:a,field:l,onChange:o,hideLabelFromVision:(null!==(t=d?.fields)&&void 0!==t?t:[]).length<2},l.id)}})]})})}const z=[{type:"regular",component:function({data:n,field:l,onChange:t,hideLabelFromVision:i}){var a;const{fields:o}=(0,h.useContext)(x),s=(0,h.useMemo)((()=>k(l)?{fields:l.children.map((e=>"string"==typeof e?{id:e}:e)),type:"regular"}:{type:"regular",fields:[]}),[l]);if(k(l))return(0,e.jsxs)(e.Fragment,{children:[!i&&l.label&&(0,e.jsx)(P,{title:l.label}),(0,e.jsx)(H,{data:n,form:s,onChange:t})]});const r=null!==(a=l.labelPosition)&&void 0!==a?a:"top",d=o.find((e=>e.id===l.id));return d?"side"===r?(0,e.jsxs)(j.__experimentalHStack,{className:"dataforms-layouts-regular__field",children:[(0,e.jsx)("div",{className:"dataforms-layouts-regular__field-label",children:d.label}),(0,e.jsx)("div",{className:"dataforms-layouts-regular__field-control",children:(0,e.jsx)(d.Edit,{data:n,field:d,onChange:t,hideLabelFromVision:!0},d.id)})]}):(0,e.jsx)("div",{className:"dataforms-layouts-regular__field",children:(0,e.jsx)(d.Edit,{data:n,field:d,onChange:t,hideLabelFromVision:"none"===r||i})}):null}},{type:"panel",component:function({data:n,field:l,onChange:t}){var i;const{fields:a}=(0,h.useContext)(x),o=a.find((e=>{if(k(l)){const n=l.children.filter((e=>"string"==typeof e||!k(e))),t="string"==typeof n[0]?n[0]:n[0].id;return e.id===t}return e.id===l.id})),s=null!==(i=l.labelPosition)&&void 0!==i?i:"side",[r,d]=(0,h.useState)(null);if(!o)return null;const c=k(l)?l.label:o?.label;return"top"===s?(0,e.jsxs)(j.__experimentalVStack,{className:"dataforms-layouts-panel__field",spacing:0,children:[(0,e.jsx)("div",{className:"dataforms-layouts-panel__field-label",style:{paddingBottom:0},children:c}),(0,e.jsx)("div",{className:"dataforms-layouts-panel__field-control",children:(0,e.jsx)(B,{field:l,popoverAnchor:r,fieldDefinition:o,data:n,onChange:t,labelPosition:s})})]}):"none"===s?(0,e.jsx)("div",{className:"dataforms-layouts-panel__field",children:(0,e.jsx)(B,{field:l,popoverAnchor:r,fieldDefinition:o,data:n,onChange:t,labelPosition:s})}):(0,e.jsxs)(j.__experimentalHStack,{ref:d,className:"dataforms-layouts-panel__field",children:[(0,e.jsx)("div",{className:"dataforms-layouts-panel__field-label",children:c}),(0,e.jsx)("div",{className:"dataforms-layouts-panel__field-control",children:(0,e.jsx)(B,{field:l,popoverAnchor:r,fieldDefinition:o,data:n,onChange:t,labelPosition:s})})]})}}];function H({data:n,form:l,onChange:t,children:i}){const{fields:a}=(0,h.useContext)(x),o=(0,h.useMemo)((()=>function(e){var n,l,t;let i="regular";["regular","panel"].includes(null!==(n=e.type)&&void 0!==n?n:"")&&(i=e.type);const a=null!==(l=e.labelPosition)&&void 0!==l?l:"regular"===i?"top":"side";return(null!==(t=e.fields)&&void 0!==t?t:[]).map((e=>{var n,l;if("string"==typeof e)return{id:e,layout:i,labelPosition:a};const t=null!==(n=e.layout)&&void 0!==n?n:i,o=null!==(l=e.labelPosition)&&void 0!==l?l:"regular"===t?"top":"side";return{...e,layout:t,labelPosition:o}}))}(l)),[l]);return(0,e.jsx)(j.__experimentalVStack,{spacing:2,children:o.map((l=>{const o=(s=l.layout,z.find((e=>e.type===s)))?.component;var s;if(!o)return null;const r=k(l)?void 0:function(e){const n="string"==typeof e?e:e.id;return a.find((e=>e.id===n))}(l);return r&&r.isVisible&&!r.isVisible(n)?null:i?i(o,l):(0,e.jsx)(o,{data:n,field:l,onChange:t},l.id)}))})}function L({data:n,form:l,fields:t,onChange:i}){const a=(0,h.useMemo)((()=>function(e){return e.map((e=>{var n,l,t,i;const a="integer"===(o=e.type)?v:"text"===o?_:"datetime"===o?w:{sort:(e,n,l)=>"number"==typeof e&&"number"==typeof n?"asc"===l?e-n:n-e:"asc"===l?e.localeCompare(n):n.localeCompare(e),isValid:(e,n)=>{if(n?.elements){const l=n?.elements?.map((e=>e.value));if(!l.includes(e))return!1}return!0},Edit:()=>null};var o;const s=e.getValue||V(e.id),r=null!==(n=e.sort)&&void 0!==n?n:function(e,n,l){return a.sort(s({item:e}),s({item:n}),l)},d=null!==(l=e.isValid)&&void 0!==l?l:function(e,n){return a.isValid(s({item:e}),n)},c=function(e,n){return"function"==typeof e.Edit?e.Edit:"string"==typeof e.Edit?C(e.Edit):e.elements?C("select"):"string"==typeof n.Edit?C(n.Edit):n.Edit}(e,a),u=e.render||(e.elements?({item:n})=>{const l=s({item:n});return e?.elements?.find((e=>e.value===l))?.label||s({item:n})}:s);return{...e,label:e.label||e.id,header:e.header||e.label||e.id,getValue:s,render:u,sort:r,isValid:d,Edit:c,enableHiding:null===(t=e.enableHiding)||void 0===t||t,enableSorting:null===(i=e.enableSorting)||void 0===i||i}}))}(t)),[t]);return l.fields?(0,e.jsx)(b,{fields:a,children:(0,e.jsx)(H,{data:n,form:l,onChange:i})}):null}const E=[{label:"Latest",value:"latest"},{label:"8.3",value:"8.3"},{label:"8.2",value:"8.2"},{label:"8.1",value:"8.1"},{label:"8.0",value:"8.0"},{label:"7.4",value:"7.4"},{label:"7.3",value:"7.3"},{label:"7.2",value:"7.2"},{label:"7.1",value:"7.1"},{label:"7.0",value:"7.0"}],M=[{label:"Wordpress nightly",value:"nightly"},{label:"6.6",value:"6.1"},{label:"6.5",value:"6.1"},{label:"6.4",value:"6.2"},{label:"6.3",value:"6.1"}];(0,i.registerPlugin)("blueprint-version-control",{render:function(){const{createNotice:n}=(0,u.useDispatch)(p.store),{editPost:l}=(0,u.useDispatch)("core/editor"),i=(0,u.useSelect)((e=>e("core/block-editor").getBlocks()),[]),o=(0,u.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta")._blueprint_config||{})),h={$schema:"https://playground.wordpress.net/blueprint-schema.json",landingPage:o.landing_page,preferredVersions:{php:o.php_version,wp:o.wp_version},phpExtensionBundles:[o.php_extension_bundles],features:{networking:o.networking},steps:[]},g=()=>{const e=i.map((e=>(delete e.attributes.metadata,e.attributes)));return h.steps=[...e],JSON.stringify(h,null,2)},b=(0,m.useCopyToClipboard)(g,(()=>{n("success",(0,t.__)("Blueprint Schema Copied!"),{type:"snackbar"})}));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(a.PluginPostStatusInfo,{children:(0,e.jsxs)(j.Toolbar,{children:[(0,e.jsx)(j.ToolbarButton,{icon:s,label:"Open in playground",href:"https://playground.wordpress.net/#"+g(),target:"_blank"}),(0,e.jsx)(j.ToolbarButton,{icon:r,label:"Download JSON",onClick:()=>{const e=g();e&&((0,f.downloadBlob)("playground-blueprint.json",e,"application/json"),n("success",(0,t.__)("Blueprint downloaded generated!"),{type:"snackbar"}))}}),(0,e.jsx)(j.ToolbarButton,{icon:d,label:"Copy JSON",ref:b}),(0,e.jsx)(j.ToolbarButton,{icon:c,label:"Open in Builder",href:"https://playground.wordpress.net/builder/builder.html#"+g(),target:"_blank"})]})}),(0,e.jsx)(a.PluginDocumentSettingPanel,{name:"playground-settings",title:"Playground Settings",children:(0,e.jsx)(L,{data:{php_version:o.php_version,wp_version:o.wp_version,landing_page:o.landing_page,php_extension_bundles:o.php_extension_bundles,networking:o.networking},fields:[{elements:E,id:"php_version",label:"PHP Version",type:"text"},{elements:M,id:"wp_version",label:"WP Version",type:"text"},{id:"landing_page",label:"Landing Page",type:"text"},{id:"php_extension_bundles",label:"PHP Extension Bundles",type:"text",elements:[{label:"Kitchen Sink",value:"kitchen-sink"},{label:"Light",value:"light"}]},{id:"networking",label:"Networking",type:"text",elements:[{label:"Enabled",value:!0},{label:"Disabled",value:!1}]}],form:{fields:["php_version","wp_version","landing_page","php_extension_bundles","networking"]},onChange:e=>{l({meta:{_blueprint_config:{...o,...e}}})}})})]})}})})();